Arduino Hello World
===================
Jorge Nunes <jorgefranconunes@gmail.com>
v0.0.1, 2014/03/08: First internal draft





== Abstract

What this article is all about.





== Introduction

What is an Arduino? The Arduino is a prototyping board with an Atmel
ATMega368p microcontroller. Its design is open source. Details at
http://www.arduino.cc/.

What is the purpose of this article? We are going to show how to make
a led blink with an Arduino board. As a side effect we will see the
tools required for compiling code to run in an ATMega 368p and how to
upload code to the Arduino.

Mapping between Arduino and Atmega328 ports:
http://arduino.cc/en/Hacking/PinMapping168#.UxrYyEEux6Y

[[fig-CircuitDiagram]]
.Circuit diagram showing how to connect the LED to the Arduino board.
image::../diagram.pdf[scaledwidth="45%"]

And the actual real setup.

[[fig-ArduinoBoard]]
.An Arduino One board with the circuit already set up.
image::../arduino-photo.jpg[scaledwidth="50%"]








== Required tools

We are not using the Arduino IDE to write our code. We are going to
write plain C code and compile it with the GCC compiler for the AVR
architecture.

The following tools are needed for creating code to be run on the
Arduino board:

* avr-gcc -- GCC cross compiler for the Atmel processor.

* avr-libc -- A libC implementation for the AVR architecture. This
  includes the ATMega368p microcontroller.

* avrdude -- Tool for uploading the code into the Arduino board.


----
yum install avr-gcc avr-libc avrdude
----





== The code

This is the code we are going to compile and run in the Arduino
board.

How did we know what to do with which ports? Well, we asked Google and
we read the ATMega368p data sheet provided by Atmel. By the time we
did it it was available at http://www.atmel.com/devices/atmega328p.aspx.

[[fig-Code]]
.Example code for the blinking LED.
[source,c]
----
#include <avr/io.h>
#include <util/delay.h>

const int BLINK_DELAY_MS = 500;

int main (void) {
    /* Set pin 5 of PORTD for output*/
    DDRD |= _BV(DDD5);
 
    while(1) {
        /* Set pin 5 high to turn led on */
        PORTD |= _BV(PORTD5);
        _delay_ms(BLINK_DELAY_MS);
 
        /* Set pin 5 low to turn led off */
        PORTD &= ~_BV(PORTD5);
        _delay_ms(BLINK_DELAY_MS);
    }
    return 0;
}
----






== Compiling the code

To compile the code:

----
avr-gcc -Os -DF_CPU=16000000UL -mmcu=atmega328p -o blink blink.c
avr-objcopy -O ihex -R .eeprom ./blink ./blink.hex
----





== Uploading the compiled code to Arduino

Finally, to upload the code to the Arduino board:

----
avrdude -c arduino -p ATMEGA328P -P /dev/ttyACM0 -U flash:w:./blink.hex:i
----

What happens we we upload code to the Arduino?





[[colophon]]
== Colophon

The circuit diagram was designed with the +gschem+ tool of the
http://www.geda-project.org/[gEDA project] software suite.

The video was edited and transcoded to MPEG-2 using the
http://www.ffmpeg.org/[FFmpeg] tools.

